generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Produto {
  id          Int          @id @default(autoincrement())
  nome        String
  sku         String       @unique
  isKit       Boolean      @default(false)
  componentes Componente[] @relation("KitToComponente")
  kitsComponentes Componente[] @relation("ProdutoToComponente")
  estoques    Estoque[]
  saidas      Saida[]
  pedidos     PedidoProduto[]
}

model Componente {
  id         Int      @id @default(autoincrement())
  quantidade Int
  produtoId  Int
  kitId      Int
  produto    Produto  @relation("ProdutoToComponente", fields: [produtoId], references: [id])
  kit        Produto  @relation("KitToComponente", fields: [kitId], references: [id])
}

model Estoque {
  produtoId    Int
  armazemId    Int
  quantidade   Int
  valorUnitario Float
  produto      Produto  @relation(fields: [produtoId], references: [id])
  armazem      Armazem  @relation(fields: [armazemId], references: [id])

  @@id([produtoId, armazemId])
}

model Saida {
  id         Int      @id @default(autoincrement())
  produtoId  Int
  quantidade Int
  armazemId  Int
  data       DateTime @default(now())
  produto    Produto  @relation(fields: [produtoId], references: [id])
  armazem    Armazem  @relation(fields: [armazemId], references: [id])
}

model Armazem {
  id      Int      @id @default(autoincrement())
  nome    String
  estoques Estoque[]
  saidas  Saida[]
}

model Fornecedor {
  id                Int      @id @default(autoincrement())
  nome              String
  cnpj              String?
  inscricaoEstadual String?

  PedidoCompra PedidoCompra[]
}

model PedidoCompra {

  id          Int             @id @default(autoincrement())

  fornecedorId Int

  comentarios String?

  status      String

  produtos    PedidoProduto[]

  armazemId   Int?

  fornecedor  Fornecedor      @relation(fields: [fornecedorId], references: [id])

}



model PedidoProduto {

  id         Int      @id @default(autoincrement())

  pedidoId   Int

  produtoId  Int

  quantidade Int

  custo      Float

  pedido     PedidoCompra @relation(fields: [pedidoId], references: [id])

  produto    Produto      @relation(fields: [produtoId], references: [id])

}
